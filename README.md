# patent-ma-matcher
An end-to-end data pipeline for Patent and M&amp;A data matching and analysis. Features a structured 4-step workflow with dedicated Python scripts for robust data processing.

# ä¸“åˆ©æ•°æ®å¤„ç†ç³»ç»Ÿ - æ“ä½œè¯´æ˜

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿç”¨äºå¤„ç†ä¸“åˆ©æ•°æ®ä¸å¹¶è´­æ•°æ®çš„åŒ¹é…ã€èšåˆå’Œåˆ†æã€‚æ•´ä¸ªæµç¨‹åˆ†ä¸º4ä¸ªä¸»è¦æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æœ‰ä¸“é—¨çš„è„šæœ¬å’Œæ¸…æ™°çš„è¾“å…¥è¾“å‡ºã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

```bash
# 1. å®‰è£…ä¾èµ–
pip install rapidfuzz pandas numpy openpyxl tqdm

# 2. è¿›å…¥å·¥ä½œç›®å½•
cd "/Users/lidachuan/Desktop/Patent Data"
```

### æ•°æ®æ–‡ä»¶å‡†å¤‡

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š
- `final_outcome.xlsx` - å¹¶è´­æ•°æ®åº“æ¨¡æ¿ï¼ˆåŒ…å« acquiror_name, gvkey, cusip, cik ç­‰åˆ—ï¼‰
- `patent_database.csv` - ä¸“åˆ©æ•°æ®ï¼ˆæˆ–æŒ‰å¹´ä»½çš„å¤šä¸ªCSVæ–‡ä»¶ï¼‰
- `compustat_19802025.csv` - Compustatå…¬å¸æ•°æ®åº“

---

## ğŸ“ å®Œæ•´æ“ä½œæµç¨‹

### æ­¥éª¤1ï¸âƒ£ï¼šè‡ªåŠ¨æ¸…æ´—ä¸åŒ¹é…

**ç›®çš„**: æ¸…æ´—å…¬å¸åç§°å¹¶è¿›è¡Œåˆ†å±‚åŒ¹é…

```bash
python æ­¥éª¤1_è‡ªåŠ¨æ¸…æ´—.py
```

**è¾“å‡ºæ–‡ä»¶**:
- `Step1_Manual_Review.xlsx` âš ï¸ **éœ€äººå·¥å®¡æ ¸**
- `Step1_Auto_Results.xlsx` âœ… è‡ªåŠ¨æ¥å—çš„ç»“æœ
- `logs/matching_log_*.log` - è¯¦ç»†æ—¥å¿—

**âš ï¸ äººå·¥å®¡æ ¸æ“ä½œï¼ˆé‡è¦ï¼‰**:
1. æ‰“å¼€ `Step1_Manual_Review.xlsx`
2. æ£€æŸ¥æ¯ä¸€è¡Œçš„åŒ¹é…æ˜¯å¦æ­£ç¡®
3. **åˆ é™¤é”™è¯¯çš„åŒ¹é…è¡Œ**
4. ä¿å­˜æ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶åä¸å˜ï¼‰

**é¢„è®¡è€—æ—¶**: 
- 1ä¸‡æ¡è®°å½•: ~10ç§’
- 10ä¸‡æ¡è®°å½•: ~1-2åˆ†é’Ÿ
- 50ä¸‡æ¡è®°å½•: ~5-10åˆ†é’Ÿ

---

### æ­¥éª¤2ï¸âƒ£ï¼šæ„å»ºè¶…çº§å­—å…¸

**ç›®çš„**: åˆå¹¶è‡ªåŠ¨ç»“æœå’Œäººå·¥å®¡æ ¸ç»“æœï¼Œç”Ÿæˆç»Ÿä¸€çš„å…¬å¸åç§°æ˜ å°„å­—å…¸

```bash
python æ­¥éª¤2_è¶…çº§å­—å…¸.py
```

**âš™ï¸ é…ç½®ï¼ˆå¯é€‰ï¼‰**:
å¦‚æœæœ‰å¤šå¹´ä»½æ•°æ®ï¼Œç¼–è¾‘ `æ­¥éª¤2_è¶…çº§å­—å…¸.py` çš„ç¬¬36-45è¡Œï¼š
```python
FILES_TO_PROCESS = [
    'Step1_Manual_Review.xlsx',   # 1993-1997å¹´ï¼ˆå·²å®¡æ ¸ï¼‰
    'Step1_Auto_Results.xlsx',
    # æ·»åŠ å…¶ä»–å¹´ä»½...
]
```

**è¾“å‡ºæ–‡ä»¶**:
- `Master_Company_Dictionary.pkl` âœ… **æ ¸å¿ƒå­—å…¸**ï¼ˆä¾›æ­¥éª¤3ä½¿ç”¨ï¼‰
- `Master_Company_Dictionary_VIEW.xlsx` - äººå·¥æŸ¥çœ‹ç”¨
- `Dictionary_Build_Statistics.xlsx` - ç»Ÿè®¡ä¿¡æ¯
- `Dictionary_Conflicts.xlsx` - å†²çªæŠ¥å‘Šï¼ˆå¦‚æœ‰ï¼‰
- `logs/dict_building_*.log` - æ—¥å¿—

**é¢„è®¡è€—æ—¶**: < 10ç§’

---

### æ­¥éª¤3ï¸âƒ£ï¼šæœ€ç»ˆæ•°æ®èšåˆ

**ç›®çš„**: ä½¿ç”¨è¶…çº§å­—å…¸å°†ä¸“åˆ©æ•°æ®æŒ‰å¹´ä»½èšåˆåˆ°final_outcome

```bash
python æ­¥éª¤3_æœ€ç»ˆèšåˆ.py
```

**è¾“å‡ºæ–‡ä»¶**:
- `final_outcome_1993_1997_COMPLETE.xlsx` âœ… **åŒ…å«ä¸“åˆ©ç»Ÿè®¡çš„å®Œæ•´æ–‡ä»¶**
  - æ–°å¢åˆ—: `patent_1993`, `patent_1994`, ..., `patent_1997`
  - æ–°å¢åˆ—: `patent_inventor_1993`, ..., `patent_inventor_1997`
  - æ–°å¢åˆ—: `patent_name`, `patent_name_1`, ...ï¼ˆå…¬å¸åˆ«åï¼‰
- `logs/aggregation_*.log` - æ—¥å¿—

**é¢„è®¡è€—æ—¶**:
- å°æ•°æ®é›†: < 30ç§’
- ä¸­ç­‰æ•°æ®é›†: 1-3åˆ†é’Ÿ
- å¤§æ•°æ®é›†: 5-15åˆ†é’Ÿ

---

### æ­¥éª¤4ï¸âƒ£Aï¼šCompustatåŒ¹é… - ç”ŸæˆéªŒè¯æ–‡ä»¶

**ç›®çš„**: åŒ¹é…å…¬å¸åˆ°Compustatæ•°æ®åº“ï¼Œç”ŸæˆéªŒè¯æ–‡ä»¶

```bash
python æ­¥éª¤4A_CompustatåŒ¹é….py
```

**è¾“å‡ºæ–‡ä»¶**:
- `company_match_verification.xlsx` âš ï¸ **éœ€äººå·¥å®¡æ ¸**
- `logs/compustat_match_4A_*.log` - æ—¥å¿—

**âš ï¸ äººå·¥å®¡æ ¸æ“ä½œï¼ˆé‡è¦ï¼‰**:
1. æ‰“å¼€ `company_match_verification.xlsx`
2. æ£€æŸ¥åŒ¹é…æ˜¯å¦æ­£ç¡®ï¼ˆé‡ç‚¹æ£€æŸ¥ Fuzzy åŒ¹é…ï¼‰
3. **åˆ é™¤é”™è¯¯çš„åŒ¹é…è¡Œ**
4. ä¿å­˜æ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶åä¸å˜ï¼‰

**é¢„è®¡è€—æ—¶**: 1-5åˆ†é’Ÿ

---

### æ­¥éª¤4ï¸âƒ£Bï¼šCompustatåŒ¹é… - åº”ç”¨å®¡æ ¸ç»“æœ

**ç›®çš„**: å°†å®¡æ ¸åçš„Compustat IDå¡«å…¥final_outcome

```bash
python æ­¥éª¤4B_CompustatåŒ¹é….py
```

**è¾“å‡ºæ–‡ä»¶**:
- `final_outcome.xlsx` âœ… **æœ€ç»ˆå®Œæ•´ç»“æœ**
  - å¡«å……äº† `gvkey`, `cusip`, `cik`, `compustat_name` åˆ—
- `logs/compustat_merge_4B_*.log` - æ—¥å¿—

**é¢„è®¡è€—æ—¶**: < 1åˆ†é’Ÿ

---

## âœ… å®Œæˆï¼

å®Œæ•´æµç¨‹è¿è¡Œå®Œæˆåï¼Œ`final_outcome.xlsx` åŒ…å«ï¼š
- âœ… å¹¶è´­å…¬å¸ä¿¡æ¯
- âœ… æŒ‰å¹´ä»½çš„ä¸“åˆ©æ•°é‡ç»Ÿè®¡
- âœ… æŒ‰å¹´ä»½çš„å‘æ˜äººæ•°é‡ç»Ÿè®¡
- âœ… ä¸“åˆ©å…¬å¸åˆ«ååˆ—è¡¨
- âœ… Compustatå…¬å¸IDï¼ˆgvkey, cusip, cikï¼‰

---

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡

```
Patent Data/
â”œâ”€â”€ æ­¥éª¤1_è‡ªåŠ¨æ¸…æ´—.py              # æ ¸å¿ƒè„šæœ¬
â”œâ”€â”€ æ­¥éª¤2_è¶…çº§å­—å…¸.py
â”œâ”€â”€ æ­¥éª¤3_æœ€ç»ˆèšåˆ.py
â”œâ”€â”€ æ­¥éª¤4A_CompustatåŒ¹é….py
â”œâ”€â”€ æ­¥éª¤4B_CompustatåŒ¹é….py
â”‚
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶å¤¹ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ temp/                          # ä¸´æ—¶æ–‡ä»¶å¤¹ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ final_outcome.xlsx             # æœ€ç»ˆç»“æœ â­
â”œâ”€â”€ Master_Company_Dictionary.pkl  # æ ¸å¿ƒå­—å…¸
â”‚
â”œâ”€â”€ Step1_Manual_Review.xlsx       # æ­¥éª¤1éœ€å®¡æ ¸
â”œâ”€â”€ Step1_Auto_Results.xlsx
â”œâ”€â”€ company_match_verification.xlsx # æ­¥éª¤4Aéœ€å®¡æ ¸
â”‚
â””â”€â”€ å®Œæ•´æµç¨‹ä½¿ç”¨æŒ‡å—.md            # è¯¦ç»†æ–‡æ¡£
```

---

## âš™ï¸ å¸¸è§è°ƒæ•´

### ä¿®æ”¹æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼

**æ­¥éª¤1** - ç¼–è¾‘ `æ­¥éª¤1_è‡ªåŠ¨æ¸…æ´—.py` ç¬¬364è¡Œï¼š
```python
# å°† 90 æ”¹ä¸º 85ï¼ˆæ›´å®½æ¾ï¼‰æˆ– 95ï¼ˆæ›´ä¸¥æ ¼ï¼‰
t1_strict, t1_fuzzy = perform_matching(df_tier1, "Tier 1", fuzzy_threshold=90)
```

**æ­¥éª¤4A** - ç¼–è¾‘ `æ­¥éª¤4A_CompustatåŒ¹é….py` ç¬¬40è¡Œï¼š
```python
FUZZY_THRESHOLD = 90  # æ”¹ä¸ºå…¶ä»–å€¼
```

### è°ƒæ•´å¹¶è¡Œå¤„ç†æ ¸å¿ƒæ•°

ç¼–è¾‘ `æ­¥éª¤1_è‡ªåŠ¨æ¸…æ´—.py` ç¬¬323è¡Œï¼š
```python
n_cores = min(cpu_count() - 1, 4)  # æ”¹ä¸º 2 æˆ– 8
```

### ç¦ç”¨å¹¶è¡Œå¤„ç†ï¼ˆå¦‚é‡å†…å­˜é—®é¢˜ï¼‰

ç¼–è¾‘ `æ­¥éª¤1_è‡ªåŠ¨æ¸…æ´—.py` ç¬¬364è¡Œï¼š
```python
# å°† use_parallel=True æ”¹ä¸º False
t1_strict, t1_fuzzy = perform_matching(df_tier1, "Tier 1", fuzzy_threshold=90, use_parallel=False)
```

---

## ğŸ” æ•…éšœæ’é™¤

### Q: NumPyç‰ˆæœ¬è­¦å‘Š
```bash
pip install --upgrade pandas pyarrow numexpr bottleneck
```

### Q: rapidfuzz å®‰è£…å¤±è´¥ï¼ˆM1/M2 Macï¼‰
```bash
pip install --upgrade pip
pip install rapidfuzz --no-binary :all:
```

### Q: Compustatæ•°æ®åŠ è½½å¾ˆæ…¢
- ç¡®ä¿ä½¿ç”¨çš„æ˜¯æ­¥éª¤4Aè„šæœ¬ï¼ˆåªè¯»å–conmåˆ—ï¼‰
- å°è¯•å‡å°‘æ•°æ®æ–‡ä»¶å¤§å°æˆ–æŒ‰å¹´ä»½åˆ†æ‰¹å¤„ç†

### Q: å†…å­˜ä¸è¶³
- ç¦ç”¨å¹¶è¡Œå¤„ç†
- å‡å°‘CPUæ ¸å¿ƒæ•°
- æŒ‰å¹´ä»½æ‹†åˆ†æ•°æ®

### Q: åŒ¹é…ç‡å¤ªä½
- é™ä½æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼ï¼ˆ85æˆ–80ï¼‰
- æ£€æŸ¥å…¬å¸åæ˜¯å¦å·®å¼‚å¤ªå¤§
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦æƒ…

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

æœ¬ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯å®ç°é«˜æ€§èƒ½ï¼š

| ä¼˜åŒ–æŠ€æœ¯ | æå‡æ•ˆæœ |
|---------|---------|
| rapidfuzzï¼ˆC++ï¼‰ | 10-100å€ |
| å¹¶è¡Œå¤„ç† | 3-4å€ |
| å‘é‡åŒ–è®¡ç®— | 10-50å€ |
| **ç»¼åˆæå‡** | **4-10å€** |

---

## ğŸ’¡ é‡è¦æç¤º

1. âš ï¸ **æ­¥éª¤1å’Œæ­¥éª¤4Açš„äººå·¥å®¡æ ¸æ˜¯å¿…éœ€çš„**ï¼Œä¸å¯è·³è¿‡
2. âœ… æ‰€æœ‰è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»º `logs/` å’Œ `temp/` æ–‡ä»¶å¤¹
3. ğŸ“ æ—¥å¿—æ–‡ä»¶åŒ…å«è¯¦ç»†ä¿¡æ¯ï¼Œé‡åˆ°é—®é¢˜æ—¶ä¼˜å…ˆæŸ¥çœ‹
4. ğŸ”„ å¦‚éœ€é‡æ–°è¿è¡ŒæŸä¸ªæ­¥éª¤ï¼Œåªéœ€é‡æ–°æ‰§è¡Œå¯¹åº”è„šæœ¬
5. ğŸ’¾ é‡è¦æ–‡ä»¶ä¼šè‡ªåŠ¨å¤‡ä»½ï¼Œæ—§æ–‡ä»¶åå¸¦æ—¶é—´æˆ³

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- è¯¦ç»†æ–‡æ¡£: `å®Œæ•´æµç¨‹ä½¿ç”¨æŒ‡å—.md`
- æ–‡ä»¶è¯´æ˜: `æ–‡ä»¶ç»„ç»‡è¯´æ˜.md`
- æ—¥å¿—ä½ç½®: `logs/` æ–‡ä»¶å¤¹

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-02-07
